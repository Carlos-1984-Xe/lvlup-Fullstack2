<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mostrar Usuario | Panel Administrador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="src/styles/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar principal ajustado -->
      <nav class="col-auto sidebar-admin d-flex flex-column position-relative px-3" style="min-width:220px;max-width:240px;">
        <div class="text-center mb-4">
          <img src="img/Logo Lvl Up.PNG" alt="Admin Logo" class="admin-logo rounded-circle bg-white" />
          <div class="fw-bold mt-2 company-title">Company</div>
        </div>
        <ul class="nav flex-column mb-4">
          <li class="nav-item">
            <a class="nav-link" href="AdminHome.html"><i class="bi bi-grid-1x2 me-2"></i> Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="AdminProducto.html"><i class="bi bi-box-seam me-2"></i> Inventario</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="bi bi-calendar-check me-2"></i> Pedidos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="bi bi-file-earmark-bar-graph me-2"></i> Reports</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="AdminUsuario.html"><i class="bi bi-person-badge me-2"></i> Usuarios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="bi bi-people me-2"></i> Customers</a>
          </li>
        </ul>
        <div class="sidebar-footer mt-auto">
          <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-gear me-2"></i> Settings</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-person-circle me-2"></i> Profile</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-search me-2"></i> Search</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-question-circle me-2"></i> FAQ</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-box-arrow-right me-2"></i> Salir</a></li>
          </ul>
        </div>
      </nav>
      <!-- Sub-menú de usuarios sobrio -->
      <aside class="col-auto admin-menu-producto d-flex flex-column align-items-start py-4 px-3" style="min-width:200px;max-width:220px;">
        <ul class="nav flex-column w-100">
          <li class="nav-item">
            <a class="nav-link menu-producto-link" href="http://127.0.0.1:3000/fullstack2-bootstrap-app/frontend/AdminNuevoUsuario.html">Nuevo Usuario</a>
          </li>
          <li class="nav-item">
            <a class="nav-link menu-producto-link" href="http://127.0.0.1:3000/fullstack2-bootstrap-app/frontend/AdminEditarUsuario.html">Editar Usuario</a>
          </li>
          <li class="nav-item">
            <a class="nav-link menu-producto-link active" href="http://127.0.0.1:3000/fullstack2-bootstrap-app/frontend/AdminMostrarUsuario.html">Mostrar Usuario</a>
          </li>
        </ul>
      </aside>
      <!-- Main content -->
      <main class="col px-0">
        <header class="admin-header">
          <h3 class="fw-bold mb-4 text-dark">Mostrar Usuarios</h3>
        </header>
        <section class="admin-content">
          <div class="card mt-2" style="min-height:350px;background:#f8f9fa;">
            <div class="card-body" id="listado-usuarios">
              <!-- Aquí se desplegará la lista de usuarios registrados -->
              <p class="text-muted">Aquí aparecerán los usuarios registrados en la tienda.</p>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Aquí puedes agregar tu script para mostrar los usuarios registrados -->
  <script type="module">
import { usuarios as usuariosBase } from './src/UsuariosC.js';

// Cargar usuarios desde localStorage y combinar con los del archivo
let usuariosLS = [];
try {
  usuariosLS = JSON.parse(localStorage.getItem('usuarios')) || [];
} catch {
  usuariosLS = [];
}

// Unir ambos arrays, evitando duplicados por RUT o correo
const usuariosMap = new Map();
[...usuariosBase, ...usuariosLS].forEach(u => {
  // Usa rut como clave principal, si no existe usa correo
  const clave = u.rut || u.correo;
  if (clave && !usuariosMap.has(clave)) {
    usuariosMap.set(clave, u);
  }
});
const usuarios = Array.from(usuariosMap.values());

const listado = document.getElementById('listado-usuarios');

if (usuarios.length === 0) {
  listado.innerHTML = `<p class="text-muted">No hay usuarios registrados en la tienda.</p>`;
} else {
  listado.innerHTML = `
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Apellidos</th>
            <th>Correo</th>
            <th>RUN</th>
            <th>Región</th>
            <th>Comuna</th>
            <th>Dirección</th>
            <th>Teléfono</th>
            <th>Rol</th>
          </tr>
        </thead>
        <tbody>
          ${usuarios.map(u => `
            <tr>
              <td>${u.id || ''}</td>
              <td>${u.nombre || ''}</td>
              <td>${u.apellidos || ''}</td>
              <td>${u.correo || ''}</td>
              <td>${u.rut || ''}</td>
              <td>${u.region || ''}</td>
              <td>${u.comuna || ''}</td>
              <td>${u.direccion || ''}</td>
              <td>${u.telefono || ''}</td>
              <td>${u.rol ? u.rol : 'Cliente'}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}
</script>
</body>
</html>